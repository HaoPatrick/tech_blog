<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us" >

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" /> 
    <title>Install Arch Linux on Hyper V | Xiangpeng Hao</title>
     <meta property='og:title' content='Install Arch Linux on Hyper V - Xiangpeng Hao'>
<meta property='og:description' content='Windows 10 Pro edition ships with a fully functioned hyper-v, which is a high-performance virtual machine widely used by the industry.
Thanks to the bad reputation for being unfriendly to newcomers, Hyper-V is a lot less-known by the public, especially when compared to VMware or Virtual Box. The problem of these two virtual machines is either expensive (VMware) or low-performance (VBox). So I finally decided to investigate on Hyper-V and try the state-of-the-art technology from Microsoft.'>
<meta property='og:url' content='/posts/install-arch-linux-on-hyper-v/'>
<meta property='og:site_name' content='Xiangpeng Hao'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2018-03-15T01:28:32-07:00'/><meta property='article:modified_time' content='2018-03-15T01:28:32-07:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="shortcut icon" href="favicon.png" /></head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="/"><h1 class="title is-4">Xiangpeng Hao</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" href='https://haoxp.xyz' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <g transform="scale(0.042)" stroke-width="4">
        <path fill="currentColor"
            d="M528 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm0 400H48V80h480v352zM208 256c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm-89.6 128h179.2c12.4 0 22.4-8.6 22.4-19.2v-19.2c0-31.8-30.1-57.6-67.2-57.6-10.8 0-18.7 8-44.8 8-26.9 0-33.4-8-44.8-8-37.1 0-67.2 25.8-67.2 57.6v19.2c0 10.6 10 19.2 22.4 19.2zM360 320h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8z">
        </path>
        
    </g>
    
</svg></i>
            </span>
          </a><a class="level-item" href='https://github.com/XiangpengHao' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
    
</svg></i>
            </span>
          </a><a class="level-item" href='https://linkedin.com/in/hao-xiangpeng' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8"
        d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z" />
    
</svg></i>
            </span>
          </a><a class="level-item" href='https://blog.haoxp.xyz/index.xml' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <g transform="scale(0.045)" stroke-width="40">
        <path
            d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z">
        </path>
    </g>
    
    
</svg></i>
            </span>
          </a><a class="level-item" href='https://t.me/newsathlh' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path
        d="m 22.05,1.577 c -0.393,-0.016 -0.784,0.08 -1.117,0.235 -0.484,0.186 -4.92,1.902 -9.41,3.64 C 9.263,6.325 7.005,7.198 5.267,7.867 3.53,8.537 2.222,9.035 2.153,9.059 c -0.46,0.16 -1.082,0.362 -1.61,0.984 -0.79581202,1.058365 0.21077405,1.964825 1.004,2.499 1.76,0.564 3.58,1.102 5.087,1.608 0.556,1.96 1.09,3.927 1.618,5.89 0.174,0.394 0.553,0.54 0.944,0.544 l -0.002,0.02 c 0,0 0.307,0.03 0.606,-0.042 0.3,-0.07 0.677,-0.244 1.02,-0.565 0.377,-0.354 1.4,-1.36 1.98,-1.928 l 4.37,3.226 0.035,0.02 c 0,0 0.484,0.34 1.192,0.388 0.354,0.024 0.82,-0.044 1.22,-0.337 0.403,-0.294 0.67,-0.767 0.795,-1.307 0.374,-1.63 2.853,-13.427 3.276,-15.38 L 23.676,4.725 C 23.972,3.625 23.863,2.617 23.18,2.02 22.838,1.723 22.444,1.593 22.05,1.576 Z" />
    
</svg></i>
            </span>
          </a></nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle is-6 is-pulled-right">
      
    </div>
    <h2 class="subtitle is-6">March 15, 2018</h2>
    <h1 class="title">Install Arch Linux on Hyper V</h1>
    
    <div class="content">
      

<p>Windows 10 Pro edition ships with a fully functioned hyper-v, which is a high-performance virtual machine widely used by the industry.</p>

<p>Thanks to the bad reputation for being unfriendly to newcomers, Hyper-V is a lot less-known by the public, especially when compared to VMware or Virtual Box. The problem of these two virtual machines is either expensive (VMware) or low-performance (VBox). So I finally decided to investigate on Hyper-V and try the state-of-the-art technology from Microsoft.</p>

<p>I&rsquo;m a fan of <a href="https://www.archlinux.org/">Arch Linux</a> and it happens to be dramatically difficult to install since it doesn&rsquo;t have an installer, which means you need to have a clear mind of how an operating system boots. Any questions are not welcomed, you should really try hard to figure out the whole process before you read this post.</p>

<h4 id="preparation">Preparation</h4>

<p>The first step is to enable Hyper-V in <code>turn windows features on or off</code>, you will probably need a restart to fully set up.</p>

<p>Then you create a new virtual machine, select the <code>second generation</code> (the latest one), by doing so you will boot on a <code>UEFI</code> machine.</p>

<p>To boot from a Linux image, you should disable the <code>secure boot</code> from the <code>security</code> panel.</p>

<p>Then comes the tricky part, to connect to the Internet. The idea is to set up a <code>virtual switch</code> and connect both your host machine and guest machine to it, you may google around about the network <code>switch</code> before you go ahead. The simplest workaround here is to create an <code>internal</code> virtual switch and connect your <code>external</code> network (wireless or ethernet) to it, then attach this <code>virtual switch</code> to the guest machine.</p>

<p>Now you have a virtual machine with the Internet connection, half done!</p>

<h4 id="install-arch-linux-on-a-uefi-machine">Install Arch Linux on a UEFI Machine</h4>

<p>Then you follow this <a href="https://wiki.archlinux.org/index.php/Installation_guide">tutorial</a> and you install it successfully.</p>

<p>(important tip: <strong>it&rsquo;s always important to read the official wiki in Arch Linux community</strong>)</p>

<p>Well, I can still give you some suggestions.</p>

<p>partition scheme</p>

<ol>
<li><p>EFI system partition <code>/dev/sda1</code> with 300M size, FAT32 formatted.</p></li>

<li><p>SWAP partition <code>/dev/sda2</code> with twice of your memory size, SWAP on.</p></li>

<li><p>Root partition <code>/dev/sda3</code> all the remaining spaces, EXT4 formatted.</p></li>
</ol>

<p>Install <code>boot loader</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#177500"># pacman -S grub efibootmgr dosfstools os-prober mtools</span>
<span style="color:#177500"># mkdir /boot/EFI</span>
<span style="color:#177500"># mount /dev/sda1 /boot/EFI  #Mount FAT32 EFI partition</span> 
<span style="color:#177500"># grub-install --target=x86_64-efi  --bootloader-id=grub_uefi --recheck</span>
<span style="color:#177500"># grub-mkconfig -o /boot/grub/grub.cfg</span></code></pre></div>
<h4 id="post-installation">Post installation</h4>

<p>Arch Linux is famous for its user contributed package management, <code>pacman</code> is the official one and you may need another to install package from <code>AUR</code>, say, <code>yarourt</code>.</p>

<p>You will also need a desktop environment, like <code>Gnome</code> or <code>KDE</code>.</p>

<p>Unlike <code>VMWare</code> which ships with a tool to handle window resize, you need to <strong>manually</strong> set the screen resolution to the grub config, which means you can&rsquo;t adjust the screen resolution on the fly.</p>

<p>You need to modify <code>/etc/default/grub</code>, add <code>video=hyperv_fb:1920x1080</code> to the <code>GRUB_CMDLINE_LINUX_DEFAULT</code>.</p>

<p>So your lines ends up looking like this: <code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash video=hyperv_fb:1280x720&quot;</code>. Then you need to <code>update-grub</code> and reboot.</p>

<p>That&rsquo;s it, hope you enjoy the journey of installing Arch Linux.</p>

      
    </div>
    
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p><a href="https://www.haoxp.xyz">Xiangpeng Hao</a> 2020</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-66103952-7', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>
</html>

